<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <style>
    @page {
      size: A4;
      margin: 1cm;
    }

    * { margin: 0; padding: 0; box-sizing: border-box; }

    body {
      font-family: 'Helvetica', 'Arial', sans-serif;
      color: #1e293b;
      line-height: 1.5;
      font-size: 11px;
      background: #ffffff;
    }

    .section-title {
      font-size: 16px;
      font-weight: bold;
      color: #1e293b;
      margin-top: 24px;
      margin-bottom: 12px;
      padding-bottom: 6px;
      border-bottom: 2px solid #e2e8f0;
    }

    .claim-card {
      background: #ffffff;
      border: 1px solid #e2e8f0;
      margin-bottom: 16px;
      padding: 14px;
      page-break-inside: avoid;
    }

    .footer {
      margin-top: 40px;
      padding-top: 16px;
      border-top: 2px solid #e2e8f0;
      text-align: center;
      color: #94a3b8;
      font-size: 10px;
    }
  </style>
</head>
<body>
  <!-- HEADER -->
  <table width="100%" style="border-bottom: 3px solid #1e40af; padding-bottom: 12px; margin-bottom: 20px;">
    <tr>
      <td width="60" valign="middle">
        <img src="file:///{{ logo_path }}" alt="Tru8" width="50" height="50" />
      </td>
      <td valign="middle" style="padding-left: 12px;">
        <div style="font-size: 28px; font-weight: bold; color: #1e40af; letter-spacing: 1px;">TRU8</div>
        <div style="font-size: 11px; color: #64748b;">Independent AI-Powered Fact-Checking Report</div>
      </td>
    </tr>
  </table>

  <!-- METADATA BOX -->
  <table width="100%" style="background: #f8fafc; border-left: 4px solid #1e40af; margin-bottom: 20px;">
    <tr>
      <td style="padding: 14px;">
        <table width="100%">
          <tr>
            <td width="120" style="font-weight: bold; color: #1e40af; padding: 3px 0;">Source URL:</td>
            <td style="color: #334155; padding: 3px 0;">{{ (check.input_url or 'User-submitted text')[:80] }}{% if check.input_url and check.input_url|length > 80 %}...{% endif %}</td>
          </tr>
          <tr>
            <td style="font-weight: bold; color: #1e40af; padding: 3px 0;">Date Checked:</td>
            <td style="color: #334155; padding: 3px 0;">{{ check.created_at.strftime('%B %d, %Y at %H:%M UTC') }}</td>
          </tr>
          <tr>
            <td style="font-weight: bold; color: #1e40af; padding: 3px 0;">Report ID:</td>
            <td style="color: #334155; padding: 3px 0;">{{ check.id[:8] }}</td>
          </tr>
          <tr>
            <td style="font-weight: bold; color: #1e40af; padding: 3px 0;">Processing Time:</td>
            <td style="color: #334155; padding: 3px 0;">{{ (check.processing_time_ms / 1000)|round(1) }} seconds</td>
          </tr>
        </table>
      </td>
    </tr>
  </table>

  <!-- OVERALL SUMMARY BOX -->
  <table width="100%" style="border: 2px solid #1e40af; margin-bottom: 20px;">
    <tr>
      <td style="padding: 18px;">
        <table width="100%" style="margin-bottom: 12px;">
          <tr>
            <td valign="top">
              <div style="font-size: 16px; font-weight: bold; color: #1e40af;">Overall Assessment</div>
            </td>
            <td align="right" valign="top">
              {% set score = check.credibility_score or 0 %}
              <div style="font-size: 32px; font-weight: bold; line-height: 1; {% if score >= 70 %}color: #059669;{% elif score >= 40 %}color: #d97706;{% else %}color: #dc2626;{% endif %}">{{ score }}/100</div>
              <div style="font-size: 10px; font-weight: bold; color: #64748b; text-transform: uppercase;">Credibility Score</div>
            </td>
          </tr>
        </table>
        <div style="font-size: 12px; line-height: 1.6; color: #334155;">{{ check.overall_summary }}</div>
      </td>
    </tr>
  </table>

  <!-- STATS ROW -->
  <table width="100%" style="margin-bottom: 22px; border: 1px solid #e2e8f0;">
    <tr>
      <td width="33.33%" align="center" style="padding: 14px 8px; background: #f0fdf4; border-right: 1px solid #e2e8f0;">
        <div style="font-size: 36px; font-weight: bold; color: #059669; line-height: 1;">{{ check.claims_supported or 0 }}</div>
        <div style="font-size: 10px; font-weight: bold; text-transform: uppercase; color: #059669; margin-top: 4px;">Supported</div>
      </td>
      <td width="33.33%" align="center" style="padding: 14px 8px; background: #fffbeb; border-right: 1px solid #e2e8f0;">
        <div style="font-size: 36px; font-weight: bold; color: #d97706; line-height: 1;">{{ check.claims_uncertain or 0 }}</div>
        <div style="font-size: 10px; font-weight: bold; text-transform: uppercase; color: #d97706; margin-top: 4px;">Uncertain</div>
      </td>
      <td width="33.34%" align="center" style="padding: 14px 8px; background: #fef2f2;">
        <div style="font-size: 36px; font-weight: bold; color: #dc2626; line-height: 1;">{{ check.claims_contradicted or 0 }}</div>
        <div style="font-size: 10px; font-weight: bold; text-transform: uppercase; color: #dc2626; margin-top: 4px;">Contradicted</div>
      </td>
    </tr>
  </table>

  <!-- CLAIMS DETAIL -->
  <div class="section-title">Claims Analyzed ({{ claims|length }})</div>

  {% for claim in claims %}
  <div class="claim-card">
    <table width="100%" style="margin-bottom: 10px;">
      <tr>
        <td valign="top" width="75%">
          <div style="font-size: 10px; font-weight: bold; color: #64748b; margin-bottom: 4px;">CLAIM {{ loop.index }}</div>
          <div style="font-size: 13px; font-weight: bold; color: #1e293b; line-height: 1.5;">{{ claim.text[:200] }}{% if claim.text|length > 200 %}...{% endif %}</div>
        </td>
        <td valign="top" align="right" width="25%">
          {% if claim.verdict == 'supported' %}
          <div style="display: inline-block; background: #059669; color: #ffffff; padding: 5px 12px; font-size: 10px; font-weight: bold; text-transform: uppercase;">SUPPORTED</div>
          {% elif claim.verdict == 'contradicted' %}
          <div style="display: inline-block; background: #dc2626; color: #ffffff; padding: 5px 12px; font-size: 10px; font-weight: bold; text-transform: uppercase;">CONTRADICTED</div>
          {% elif claim.verdict == 'uncertain' %}
          <div style="display: inline-block; background: #d97706; color: #ffffff; padding: 5px 12px; font-size: 10px; font-weight: bold; text-transform: uppercase;">UNCERTAIN</div>
          {% elif claim.verdict == 'insufficient_evidence' %}
          <div style="display: inline-block; background: #64748b; color: #ffffff; padding: 5px 12px; font-size: 10px; font-weight: bold; text-transform: uppercase;">INSUFFICIENT</div>
          {% else %}
          <div style="display: inline-block; background: #94a3b8; color: #ffffff; padding: 5px 12px; font-size: 10px; font-weight: bold; text-transform: uppercase;">{{ claim.verdict|upper }}</div>
          {% endif %}
          <div style="font-size: 10px; color: #64748b; margin-top: 6px;">{{ claim.confidence }}% confidence</div>
        </td>
      </tr>
    </table>

    <table width="100%" style="margin-bottom: 10px;">
      <tr>
        <td>
          <table width="100%" cellspacing="0" cellpadding="0" style="background: #e2e8f0; height: 6px;">
            <tr>
              {% if claim.verdict == 'supported' %}
              <td style="width: {{ claim.confidence }}%; height: 6px; background: #059669;"></td>
              {% elif claim.verdict == 'contradicted' %}
              <td style="width: {{ claim.confidence }}%; height: 6px; background: #dc2626;"></td>
              {% else %}
              <td style="width: {{ claim.confidence }}%; height: 6px; background: #d97706;"></td>
              {% endif %}
              <td style="height: 6px;"></td>
            </tr>
          </table>
        </td>
      </tr>
    </table>

    <table width="100%" style="background: #f8fafc; border-left: 3px solid #1e40af; margin-bottom: 10px;">
      <tr>
        <td style="padding: 10px 12px;">
          <div style="font-size: 11px; color: #475569; line-height: 1.5; font-style: italic;">{{ claim.rationale }}</div>
        </td>
      </tr>
    </table>

    {% if claim.evidence %}
    <div style="font-size: 11px; font-weight: bold; color: #1e40af; margin-bottom: 8px;">Evidence Sources ({{ claim.evidence|length }})</div>

    {% for evidence in claim.evidence[:3] %}
    <table width="100%" style="margin-bottom: 8px; border-left: 2px solid #e2e8f0; background: #fafafa;">
      <tr>
        <td style="padding: 8px 10px;">
          <div style="font-size: 10px; font-weight: bold; color: #1e40af;">
            {{ evidence.source }}
            {% if evidence.external_source_provider %}
            <span style="display: inline-block; background: #059669; color: #ffffff; padding: 1px 5px; font-size: 8px; font-weight: bold; text-transform: uppercase; margin-left: 6px; border-radius: 2px;">API</span>
            {% elif evidence.is_factcheck %}
            <span style="display: inline-block; background: #7c3aed; color: #ffffff; padding: 1px 5px; font-size: 8px; font-weight: bold; text-transform: uppercase; margin-left: 6px; border-radius: 2px;">FACT-CHECK</span>
            {% endif %}
          </div>
          <div style="font-size: 10px; color: #334155; margin-top: 2px;">{{ evidence.title[:80] }}{% if evidence.title|length > 80 %}...{% endif %}</div>
          {% if evidence.snippet %}
          <div style="font-size: 9px; color: #64748b; margin-top: 4px; line-height: 1.4;">{{ evidence.snippet[:120] }}{% if evidence.snippet|length > 120 %}...{% endif %}</div>
          {% endif %}
        </td>
      </tr>
    </table>
    {% endfor %}
    {% endif %}
  </div>
  {% endfor %}

  <!-- FOOTER -->
  <div class="footer">
    <div style="font-weight: bold; color: #1e40af; font-size: 12px; margin-bottom: 4px;">TRU8</div>
    <div>This report was generated automatically using AI-powered fact-checking technology.</div>
    <div>For more information, visit https://tru8.com</div>
    <div style="margin-top: 8px;">Report ID: {{ check.id[:8] }} | Generated on {{ now.strftime('%B %d, %Y at %H:%M UTC') }}</div>
    <div style="margin-top: 8px; font-size: 9px;">
      Disclaimer: This automated analysis is provided for informational purposes. Users should verify critical information independently.
    </div>
  </div>
</body>
</html>